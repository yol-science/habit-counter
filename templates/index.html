<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ç¿’æ…£ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">
  <h1>ãƒ©ã‚¤ãƒ•å¼ ç¿’æ…£ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</h1>

<div class="add-area">
  <input type="text" id="newHabit" placeholder="æ–°ã—ã„ç¿’æ…£ã‚’è¿½åŠ ">
  <button onclick="addHabit()">è¿½åŠ </button>
</div>

  <div id="status" class="card-area"></div>
</div>

<script>
function heart(life){
  return "â¤ï¸".repeat(life) + "ğŸ–¤".repeat(3-life)
}

function add(activity){
  fetch("/api/add",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({activity})
  }).then(()=>refresh())
}

function addHabit(){
  const name = document.getElementById("newHabit").value
  if(!name) return

  fetch("/api/add_habit",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  }).then(()=>{
    document.getElementById("newHabit").value=""
    refresh()
  })
}

function deleteHabit(name){
  fetch("/api/delete_habit",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name})
  }).then(refresh)
}

function refresh(){
  fetch("/api/today")
    .then(r=>r.json())
    .then(data=>{
      let output=""

      if(Object.keys(data).length === 0){
        output = "<p>ã¾ã ç¿’æ…£ãŒã‚ã‚Šã¾ã›ã‚“ ğŸŒ±</p>"
      } else {

        for(let key in data){
          output += `
          <div class="card">
            <h2>${key}</h2>
            <div class="life">${heart(data[key].life)}</div>
            <div class="total">ç´¯è¨ˆ: ${data[key].total}</div>
            <button onclick="add('${key}')">+1</button>
            <button onclick="deleteHabit('${key}')">å‰Šé™¤</button>
          </div>
          `
        }

      }

      document.getElementById("status").innerHTML = output
    })
}

refresh()
</script>

</body>
</html>